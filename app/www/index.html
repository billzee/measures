<!DOCTYPE HTML>
  <html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <script type="text/javascript" src="components/loader.js"></script>
  </head>
  <body>
   
    <canvas id="canvas" width="1024" height="768"></canvas>
    <script>
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var start = new Object();
		var end = new Object();
    var move = new Object();
		var img = new Image();
		canvas.addEventListener("touchstart", handleStart, false);
		canvas.addEventListener("touchend", handleEnd, false);
    canvas.addEventListener("touchmove", handleMove, false);


    function handleStart(event){
      console.log("start");
      event.preventDefault(); 
      start.x = event.targetTouches[0].pageX;
      start.y = event.targetTouches[0].pageY;
    }

    function handleMove(event){
      console.log("move");
      event.preventDefault(); 
      console.log(event);
      move.x = event.changedTouches[0].pageX;
      move.y = event.changedTouches[0].pageY;
      var line = new Line(start.x,start.y,move.x,move.y);
      line.drawWithArrowheads(ctx);
      
    }


		function handleEnd(event){
			event.preventDefault(); 
      
      
      /*end.x = event.changedTouches[0].pageX;
			end.y = event.changedTouches[0].pageY;
      line.drawWithArrowheads(ctx);*/
		}


    function Line(x1,y1,x2,y2){
        this.x1=x1;
        this.y1=y1;
        this.x2=x2;
        this.y2=y2;
    }
    Line.prototype.drawWithArrowheads=function(ctx){

        // arbitrary styling
        ctx.strokeStyle="blue";
        ctx.fillStyle="blue";
        ctx.lineWidth=1;

        // draw the line
        ctx.beginPath();
        ctx.moveTo(this.x1,this.y1);
        ctx.lineTo(this.x2,this.y2);
        ctx.stroke();
        

        // draw the starting arrowhead
      /*  var startRadians=Math.atan((this.y2-this.y1)/(this.x2-this.x1));
        startRadians+=((this.x2>this.x1)?-90:90)*Math.PI/180;
        this.drawArrowhead(ctx,this.x1,this.y1,startRadians);*/
        // draw the ending arrowhead
/*        var endRadians=Math.atan((this.y2-this.y1)/(this.x2-this.x1));
        endRadians+=((this.x2>this.x1)?90:-90)*Math.PI/180;
        this.drawArrowhead(ctx,this.x2,this.y2,endRadians);*/


    }
    Line.prototype.drawArrowhead=function(ctx,x,y,radians){
        ctx.save();
        ctx.beginPath();
        ctx.translate(x,y);
        ctx.rotate(radians);
        ctx.moveTo(0,0);
        ctx.lineTo(5,20);
        ctx.lineTo(-5,20);
        ctx.closePath();
        ctx.restore();
        ctx.fill();
    }
    	
	img.onload = function() {
		canvas.height = canvas.width * (img.height / img.width);
		var oc = document.createElement('canvas'),
		octx = oc.getContext('2d');
		oc.width = img.width * 0.5;
		oc.height = img.height * 0.5;
		octx.drawImage(img, 0, 0, oc.width, oc.height);
		octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);
		ctx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5,
		0, 0, canvas.width, canvas.height);
	};
	img.src = "img/teste.jpg";


    </script>
  </body>

     
</html>